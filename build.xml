<?xml version="1.0"?>
<project name = "Lab3" default="compile" basedir=".">
    <property file="build.properties"/>

    <path id="classpathCompile">
        <fileset dir="${lib}" includes="**/*.jar"/>
    </path>

    <path id="classpathTestcompile">
        <fileset dir="${lib}" includes="**/*.jar"/>
        <pathelement path="${build.main}"/>
    </path>

    <path id="test">
        <fileset dir="${lib}" includes="**/*.jar"/>
        <pathelement path="${build.main}"/>
        <pathelement path="${build.test}"/>
    </path>

    <path id="classpathTestCompile">
        <fileset dir="${lib}" includes="**/*.jar"/>
        <pathelement path="${build.main}/WEB-INF/classes"/>
    </path>

    <target name="clean">
        <delete dir="${build}"/>
        <delete dir="${doc}"/>
        <delete dir="${cache}"/>
        <delete dir="${dist}"/>
        <echo message="Clean done"/>
    </target>

    <target name="init">
        <mkdir dir="${build.main}"/>
        <mkdir dir="${build.main}/WEB-INF/classes"/>
        <mkdir dir="${build.main}/WEB-INF/lib"/>
        <mkdir dir="${build.main}/resources"/>
        <mkdir dir="${build.test}"/>
        <mkdir dir="${doc}"/>
        <mkdir dir="${cache}"/>
        <mkdir dir="${dist}"/>
        <echo>Creating the build directory</echo>
    </target>

    <target name="compile" depends="clean, init">
        <echo>Compile the source files</echo>
        <javac srcdir="${src.main}" destdir="${build.main}/WEB-INF/classes" classpathref="classpathCompile" errorProperty="compile.fail"
               failonerror="false"/>
    </target>

    <target name="copy" depends="compile">
        <copy todir="${build.main}/resources">
            <fileset dir="${web.content}"/>
        </copy>
        <copy todir="${build.main}/WEB-INF/lib">
            <fileset dir="${lib}"/>
        </copy>
        <copy todir="${build.main}/WEB-INF">
            <fileset dir="web/WEB-INF"/>
        </copy>
        <copy todir="${build.main}">
            <fileset file="web/index.xhtml"/>
            <fileset file="web/main.xhtml"/>
        </copy>
    </target>

    <target name="testCompile" depends="compile">
        <javac srcdir="${src.test}" destdir="${build.test}" classpathref="classpathTestCompile"/>
    </target>

    <target name="war" depends="copy">
        <echo>Building the war file</echo>
        <war destfile="${dist}/${project.name}.war" webxml="${build.main}/WEB-INF/web.xml">
            <fileset dir="${build.main}"/>
        </war>
    </target>
</project>